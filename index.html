<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Status</title>

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1 id="status"></h1>
    <div class="sub" id="countdown"></div>
  </div>

  <script>
    const TZ = "Europe/Copenhagen";
    const BLOCK_MS = 10 * 60 * 1000;   // :00, :10, :20 ...
    const ALARM_MS = 5 * 60 * 1000;    // 5-minute countdown

    function pad(n) { return String(n).padStart(2, "0"); }

    function formatMMSS(ms) {
      const totalSeconds = Math.max(0, Math.ceil(ms / 1000));
      const m = Math.floor(totalSeconds / 60);
      const s = totalSeconds % 60;
      return `${pad(m)}:${pad(s)}`;
    }

    function getCopenhagenHMS(date = new Date()) {
      const dtf = new Intl.DateTimeFormat("da-DK", {
        timeZone: TZ,
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hourCycle: "h23"
      });
      const parts = dtf.formatToParts(date);
      const map = Object.fromEntries(parts.map(p => [p.type, p.value]));
      return { h: Number(map.hour), m: Number(map.minute), s: Number(map.second) };
    }

    function msSinceMidnightCopenhagen(now = new Date()) {
      const { h, m, s } = getCopenhagenHMS(now);
      return (((h * 60 + m) * 60 + s) * 1000) + now.getMilliseconds();
    }

    function render() {
      const statusEl = document.getElementById("status");
      const cdEl = document.getElementById("countdown");

      const inBlock = msSinceMidnightCopenhagen() % BLOCK_MS;

      if (inBlock < ALARM_MS) {
        const remaining = ALARM_MS - inBlock;
        statusEl.textContent = "Alarm";
        statusEl.className = "alarm";
        cdEl.textContent = formatMMSS(remaining);
        cdEl.style.visibility = "visible";
      } else {
        statusEl.textContent = "alt er fint";
        statusEl.className = "";
        cdEl.textContent = "";
        cdEl.style.visibility = "hidden";
      }
    }

    render();
    setInterval(render, 200);
  </script>
</body>
</html>
